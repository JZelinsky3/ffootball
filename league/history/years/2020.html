<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2020 Season | JZ Fantasy Football</title>
  <link rel="stylesheet" href="../../league.css" />
  <link rel="stylesheet" href="years.css" />
</head>
<body>
  <header>
    <div class="navbar">
      <div class="logo">
        <a href="../history.html" class="back-link">‚Üê Back to History</a>
      </div>
      <h1 class="page-title">League History</h1>
      <div class="menu-toggle" id="menuToggle" aria-label="Open menu" aria-expanded="false">
        <div></div><div></div><div></div>
      </div>
      <nav class="nav-links" id="navMenu" role="menu">
        <a href="../../league.html" role="menuitem">League Hub</a>
        <a href="../../standings/standings.html" role="menuitem">Standings</a>
        <a href="../../odds/odds.html" role="menuitem">Season Odds</a>
        <a href="../../players/players.html" role="menuitem">Managers</a>
        <a href="../../news/news.html" role="menuitem">League News</a>
      </nav>
    </div>
  </header>

  <main class="year-wrap">
    <section class="year-hero">
      <h1>2020 Season</h1>
      <p>Season 2020 recap with podium, table, and bracket.</p>
      <div class="year-links">
        <a href="2019.html">2019</a>
        <a href="2020.html" aria-current="page">2020</a>
        <a href="2021.html">2021</a>
        <a href="2022.html">2022</a>
        <a href="2023.html">2023</a>
        <a href="2024.html">2024</a>
      </div>
    </section>

    <section class="year-grid">
      <article class="card">
        <h2>Podium and Rankings</h2>
        <div class="podium" id="podium"></div>
        <table class="table" id="standingsTable">
          <thead>
            <tr>
              <th>Rank</th><th>Name</th><th>Record</th><th>PF</th><th>PA</th><th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </article>

      <section class="card full-width">
        <h2>Playoffs Bracket</h2>
        <div class="bracket-wrap" id="bracketWrap">
          <svg class="bracket-svg" id="bracketSvg" aria-hidden="true"></svg>
          <div class="bracket eight" id="bracket"></div>
        </div>
      </section>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 JZ Fantasy Football. All rights reserved.</p>
  </footer>

  <script>
    const $ = id => document.getElementById(id);
    const el = (tag, cls, html) => { const e=document.createElement(tag); if(cls) e.className=cls; if(html!==undefined) e.innerHTML=html; return e; };
    const seedChip = seed => `<span class="seedchip">#${seed}</span>`;
    const toStatsBlock = r => !r ? '<div class="stats">PF  PA  Diff</div>' : `<div class="stats"><div>PF ${r.points_for.toFixed(1)}</div><div>PA ${r.points_against.toFixed(1)}</div><div>Diff ${r.point_diff.toFixed(1)}</div></div>`;

    function buildPodium(first, second, third){
      const wrap = $('podium');
      wrap.append(
        el('div','place second', `<h3>Second</h3><div class="name">${second?.name||'TBD'} ${second?`(${second.record})`:''}</div><div class="pedestal">${toStatsBlock(second)}</div>`),
        el('div','place first',  `<h3>Champion</h3><div class="name">${first?.name||'TBD'} ${first?`(${first.record})`:''}</div><div class="pedestal">${toStatsBlock(first)}</div>`),
        el('div','place third',  `<h3>Third</h3><div class="name">${third?.name||'TBD'} ${third?`(${third.record})`:''}</div><div class="pedestal">${toStatsBlock(third)}</div>`)
      );
    }

    function nodeMatch(obj, cls=''){
      const n = el('div', `node ${cls}`.trim());
      n.id = obj.id;
      const [t1, t2] = obj.teams || [{},{}];
      const row = t => {
        const r = el('div','team');
        r.innerHTML = `<div class="name">${t.seed ? seedChip(t.seed) : ''} ${t.name||'TBD'}</div>`;
        if(obj.winner && t.name === obj.winner) r.appendChild(el('span','win-badge','Winner'));
        return r;
      };
      n.append(el('div','node-head', `<span>${obj.title||''}</span>`), el('div','teams',''));
      n.querySelector('.teams').append(row(t1), row(t2));
      return n;
    }

    function centerY(target, sources){
      const getMid = el => el.getBoundingClientRect().top + el.getBoundingClientRect().height / 2;
      const tgt = $(target);
      if(!tgt) return;
      const srcs = sources.map(id => $(id)).filter(Boolean);
      const avg = srcs.reduce((a,e) => a + getMid(e), 0) / srcs.length;
      const cur = getMid(tgt);
      tgt.style.transform = `translateY(${(avg - cur).toFixed(1)}px)`;
    }

    function line(svg, a, b, sc){
      const ra=a.getBoundingClientRect(), rb=b.getBoundingClientRect();
      const x1=ra.right-sc.left, y1=ra.top+ra.height/2-sc.top;
      const x2=rb.left -sc.left, y2=rb.top+rb.height/2-sc.top;
      const mx=(x1+x2)/2;
      const p=document.createElementNS('http://www.w3.org/2000/svg','path');
      p.setAttribute('d',`M ${x1} ${y1} C ${mx} ${y1}, ${mx} ${y2}, ${x2} ${y2}`);
      p.setAttribute('fill','none');
      p.setAttribute('stroke','rgba(99,102,241,.55)');
      p.setAttribute('stroke-width','2');
      p.setAttribute('stroke-linecap','round');
      svg.appendChild(p);
    }

    async function init(){
      try{
        const res = await fetch('2020.json');
        if(!res.ok) throw new Error('JSON not found');
        const data = await res.json();

        const byRank = [...data.rankings].sort((a,b)=>a.rank-b.rank);
        buildPodium(byRank[0], byRank[1], byRank[2]);

        const tbody = document.querySelector('#standingsTable tbody');
        tbody.innerHTML = byRank.filter(r=>r.rank>3).map(r=>`<tr><td>${r.rank}</td><td>${r.name}</td><td>${r.record}</td><td>${r.points_for.toFixed(1)}</td><td>${r.points_against.toFixed(1)}</td><td>${r.point_diff.toFixed(1)}</td></tr>`).join('');

        const bracket = $('bracket');
        const col = t => { const c=el('div','round-col'); c.appendChild(el('div','round-title',t)); return c; };

        const games = data.playoffs?.games || {};
        const qf = col('Quarterfinals'); (games.quarterfinals||[]).forEach(g => qf.appendChild(nodeMatch(g)));
        const sf = col('Semifinals');    (games.semifinals||[]).forEach(g => sf.appendChild(nodeMatch(g)));
        const ch = col('Championship');  (games.championship||[]).forEach(g => ch.appendChild(nodeMatch(g)));
        ch.appendChild(el('div','round-title third-spacer',''));
        (games.third||[]).forEach(g => { const n=nodeMatch(g); n.classList.add('third'); ch.appendChild(n); });

        bracket.append(qf, sf, ch);

        const map = {};
        const add = (to, from) => { if(!to || !from) return; map[to] = map[to] || []; if(!map[to].includes(from)) map[to].push(from); };
        (games.semifinals||[]).forEach(g => g.teams?.forEach(t => add(g.id, t.from)));
        (games.championship||[]).forEach(g => g.teams?.forEach(t => add(g.id, t.from)));

        const redraw = () => {
          Object.keys(map).forEach(id => { const el = $(id); if(el) el.style.transform=''; });
          Object.entries(map).forEach(([to, froms]) => centerY(to, froms));
          const svg = $('bracketSvg'), wrap = $('bracketWrap');
          if(svg && wrap){
            const sc = wrap.getBoundingClientRect();
            svg.innerHTML='';
            svg.setAttribute('width', sc.width);
            svg.setAttribute('height', sc.height);
            svg.setAttribute('viewBox', `0 0 ${sc.width} ${sc.height}`);
            Object.entries(map).forEach(([to, froms]) => froms.forEach(f => line(svg, $(f), $(to), sc)));
          }
        };

        requestAnimationFrame(redraw);
        window.addEventListener('resize', () => requestAnimationFrame(redraw));
        window.addEventListener('load',   () => requestAnimationFrame(redraw));
        setTimeout(() => requestAnimationFrame(redraw), 120);
      }catch(err){
        const tbl = $('#standingsTable').parentElement;
        tbl.appendChild(el('p','subtle','Could not load 2020.json. If opened directly, run a local server so fetch() works (e.g., python -m http.server).'));
        console.error(err);
      }
    }
    init();
  </script>
</body>
</html>
