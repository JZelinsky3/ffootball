<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2021 Season | JZ Fantasy Football</title>
  <link rel="stylesheet" href="../../league.css" />
  <link rel="stylesheet" href="years.css" />
</head>
<body>
  <header>
  <div class="navbar">
    <div class="logo">
      <a href="../../../index.html">
        <img src="../../pics/pamilk.png" alt="JZ Fantasy Logo" class="logo-img" />
      </a>
    </div>

    <h1 class="page-title">League History</h1>

    <div class="menu-toggle" id="menuToggle" aria-label="Open menu" aria-expanded="false">
      <div></div><div></div><div></div>
    </div>

    <nav class="nav-links" id="navLinks">
      <a href="../../league.html">League Hub</a>
      <a href="../../standings/standings.html">Standings</a>
      <a href="../../records/record.html">Record Book</a>
      <a href="../../odds/odds.html">Season Odds</a>
      <a href="../../wins/wins.html">All Time Wins</a>
      <a href="../../per-records/pr.html">Personal Records</a>
      <a href="../../players/players.html">Managers</a>
      <a href="../history.html">History</a>
    </nav>
  </div>
</header>
  <main class="year-wrap">
    <section class="year-hero">
      <h1>2021 Season</h1>
      <p>Season 2021 recap with podium, table, and bracket.</p>
      <div class="year-links">
        <a href="2019.html">2019</a>
        <a href="2020.html">2020</a>
        <a href="2021.html" aria-current="page">2021</a>
        <a href="2022.html">2022</a>
        <a href="2023.html">2023</a>
        <a href="2024.html">2024</a>
      </div>
    </section>

    <section class="year-grid">
      <!-- Podium + Standings -->
      <article class="card">
        <h2>Podium and Rankings</h2>
        <div class="podium" id="podium"></div>
        <table class="table" id="standingsTable">
          <thead>
            <tr>
              <th>Rank</th><th>Name</th><th>Record</th><th>PF</th><th>PA</th><th>Diff</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </article>

      <!-- Bracket -->
      <section class="card full-width">
        <h2>Playoffs Bracket</h2>
        <div class="bracket-wrap" id="bracketWrap">
          <svg class="bracket-svg" id="bracketSvg" aria-hidden="true"></svg>
          <div class="bracket" id="bracket"></div>
        </div>
      </section>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 JZ Fantasy Football. All rights reserved.</p>
  </footer>

  <script>
    /* =========================
       Helpers & Nav
    ========================= */
    const $ = (id) => document.getElementById(id);
    const el = (tag, cls, html) => { const x=document.createElement(tag); if(cls) x.className=cls; if(html!==undefined) x.innerHTML=html; return x; };
    const seedChip = (seed) => `<span class="seedchip">#${seed}</span>`;
    const toStatsBlock = (r) => {
      if(!r) return '<div class="stats">PF  PA  Diff</div>';
      const pf = Number(r.points_for).toFixed(1), pa = Number(r.points_against).toFixed(1), df = Number(r.point_diff).toFixed(1);
      return `<div class="stats"><div>PF ${pf}</div><div>PA ${pa}</div><div>Diff ${df}</div></div>`;
    };

    /* =========================
       Podium
    ========================= */
    function buildPodium(first, second, third){
      const wrap = $('podium');
      wrap.append(
        el('div','place third',  `<h3>Third</h3><div class="name">${third?.name||'TBD'} ${third?`(${third.record})`:''}</div><div class="pedestal">${toStatsBlock(third)}</div>`),
        el('div','place first',  `<h3>Champion</h3><div class="name">${first?.name||'TBD'} ${first?`(${first.record})`:''}</div><div class="pedestal">${toStatsBlock(first)}</div>`),
        el('div','place second', `<h3>Second</h3><div class="name">${second?.name||'TBD'} ${second?`(${second.record})`:''}</div><div class="pedestal">${toStatsBlock(second)}</div>`)
      );
    }

    /* =========================
       Bracket nodes
    ========================= */
    function nodeBye(obj){
      const n = el('div', 'node bye');
      n.id = obj.id;
      n.innerHTML = `
        <div class="teams">
          <div class="team"><div class="name">${seedChip(obj.seed)} ${obj.team}</div></div>
        </div>`;
      return n;
    }
    function nodeMatch(obj, cls=''){
      const n = el('div', `node ${cls}`.trim());
      n.id = obj.id;
      const [t1, t2] = obj.teams || [{},{}];
      const row = (t) => {
        const r = el('div','team');
        r.innerHTML = `<div class="name">${t.seed ? seedChip(t.seed) : ''} ${t.name||'TBD'}</div>`;
        if(obj.winner && t.name === obj.winner) r.appendChild(el('span','win-badge','Winner'));
        return r;
      };
      n.append(el('div','node-head', `<span>${obj.title||''}</span>`), el('div','teams',''));
      n.querySelector('.teams').append(row(t1), row(t2));
      return n;
    }

    /* =========================
       Connectors
    ========================= */
    function lineBetween(svg, a, b){
      if(!svg || !a || !b) return;
      const ra=a.getBoundingClientRect(), rb=b.getBoundingClientRect(), sc=svg.getBoundingClientRect();
      const x1=ra.right-sc.left, y1=ra.top+ra.height/2-sc.top;
      const x2=rb.left -sc.left, y2=rb.top+rb.height/2-sc.top;
      const mx=(x1+x2)/2;
      const p=document.createElementNS('http://www.w3.org/2000/svg','path');
      p.setAttribute('d',`M ${x1} ${y1} C ${mx} ${y1}, ${mx} ${y2}, ${x2} ${y2}`);
      p.setAttribute('fill','none'); p.setAttribute('stroke','rgba(99,102,241,.55)'); p.setAttribute('stroke-width','2'); p.setAttribute('stroke-linecap','round');
      svg.appendChild(p);
    }

    function centerNodes(){
      const cY = (el) => { const r=el.getBoundingClientRect(); return r.top + r.height/2; };
      const setShift = (el, targetY) => {
        const r=el.getBoundingClientRect(); const cur=r.top+r.height/2;
        el.style.transform = `translateY(${(targetY-cur).toFixed(1)}px)`;
      };
      const B1=$('B1'), W1=$('W1'), W2=$('W2'), B2=$('B2'), D1=$('D1'), D2=$('D2'), F1=$('F1');
      if(!(B1&&W1&&W2&&B2&&D1&&D2&&F1)) return;
      [D1,D2,F1].forEach(n => n.style.transform='');

      setShift(D1, (cY(B1)+cY(W1))/2);
      setShift(D2, (cY(W2)+cY(B2))/2);
      setShift(F1, (cY(D1)+cY(D2))/2);
    }

    function drawConnectors(){
      const svg = $('bracketSvg'), wrap = $('bracketWrap');
      if(!svg || !wrap) return;
      const r = wrap.getBoundingClientRect();
      svg.innerHTML='';
      svg.setAttribute('width', r.width);
      svg.setAttribute('height', r.height);
      svg.setAttribute('viewBox', `0 0 ${r.width} ${r.height}`);

      // Wildcard -> Divisional
      lineBetween(svg, $('B1'), $('D1')); // #1 bye -> Game 3
      lineBetween(svg, $('W1'), $('D1')); // Game 1 -> Game 3
      lineBetween(svg, $('W2'), $('D2')); // Game 2 -> Game 4
      lineBetween(svg, $('B2'), $('D2')); // #2 bye -> Game 4
      // Divisional -> Championship
      lineBetween(svg, $('D1'), $('F1')); // Game 3 -> Game 5
      lineBetween(svg, $('D2'), $('F1')); // Game 4 -> Game 5
      // Third place intentionally not connected
    }

    function redraw(){ centerNodes(); requestAnimationFrame(drawConnectors); }

    /* =========================
       Render
    ========================= */
    async function init(){
      try{
        const res = await fetch('2021.json');
        if(!res.ok) throw new Error('JSON not found');
        const data = await res.json();

        // Podium + table
        const byRank=[...data.rankings].sort((a,b)=>a.rank-b.rank);
        buildPodium(byRank[0], byRank[1], byRank[2]);

        const tbody = document.querySelector('#standingsTable tbody');
        tbody.innerHTML = byRank
          .filter(r=>r.rank>3)
          .map(r=>`
            <tr>
              <td>${r.rank}</td><td>${r.name}</td><td>${r.record}</td>
              <td>${Number(r.points_for).toFixed(1)}</td>
              <td>${Number(r.points_against).toFixed(1)}</td>
              <td>${Number(r.point_diff).toFixed(1)}</td>
            </tr>`).join('');

        // Bracket columns
        const bracket=$('bracket');
        const col = t => { const c=el('div','round-col'); c.appendChild(el('div','round-title',t)); return c; };

        const games = data.playoffs?.games || {};
        const wc = col('Wildcard');     (games.wildcard||[]).forEach(g => wc.appendChild(g.type==='bye' ? nodeBye(g) : nodeMatch(g)));
        const dv = col('Divisional');   (games.divisional||[]).forEach(g => dv.appendChild(nodeMatch(g)));
        const ch = col('Championship'); (games.championship||[]).forEach(g => ch.appendChild(nodeMatch(g)));
        ch.appendChild(el('div','round-title third-spacer',''));
        (games.third||[]).forEach(g => { const n=nodeMatch(g); n.classList.add('third'); ch.appendChild(n); });

        bracket.append(wc, dv, ch);

        // Layout + connectors after DOM paints
        requestAnimationFrame(redraw);
        window.addEventListener('resize', () => requestAnimationFrame(redraw));
        window.addEventListener('load', () => requestAnimationFrame(redraw));
        setTimeout(() => requestAnimationFrame(redraw), 120);
      }catch(err){
        // Helpful message if opened via file://
        const tbl = $('#standingsTable').parentElement;
        tbl.appendChild(el('p','subtle', 'Could not load 2021.json. If you are opening this file directly, run a local server so fetch() can load JSON (e.g., python -m http.server).'));
        console.error(err);
      }
    }

    init();
  </script>
  <script>
  const menuBtn = document.getElementById('menuToggle');
  const navLinks = document.getElementById('navLinks');
  if(menuBtn && navLinks){
    menuBtn.addEventListener('click', () => {
      menuBtn.classList.toggle('active');
      const open = navLinks.classList.toggle('show');
      menuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
  }
</script>

</body>
</html>
